---
kind: pipeline
name: build

platform:
  os: linux
  arch: amd64

clone:
  disable: true

steps:
  - name: git
    pull: if-not-exists
    image: plugins/git
    settings:
      depath: 50
      tags: true

  - name: front
    pull: if-not-exists
    image: node:19.9.0
    commands:
      - yarn run build
      - yarn run serve
    when:
      branch:
        - master
        - dev

  - name: scp
    pull: if-not-exists
    image: appleboy/drone-scp
    settings:
      host:
        - 143.198.208.10
      port: 22
      source:
        - src
        - Dockerfile
        - '*.json'
        - '*.js'
      target: /var/www/resume
      username: stan
    environment:
      SSH_KEY:
        from_secret: ssh_key
    when:
      branch:
        - master
        - dev
